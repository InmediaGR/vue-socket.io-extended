!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueSocketIOExt=t()}(this,function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),n=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},r=new(function(){function n(){e(this,n),this.listeners=new Map}return t(n,[{key:"addListener",value:function(e,t,n){return"function"==typeof t&&(this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push({callback:t,vm:n}),!0)}},{key:"removeListener",value:function(e,t,n){var r=this.listeners.get(e),o=void 0;return!!(r&&r.length&&(o=r.reduce(function(e,r,o){return"function"==typeof r.callback&&r.callback===t&&r.vm==n?e=o:e},-1))>-1)&&(r.splice(o,1),this.listeners.set(e,r),!0)}},{key:"emit",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=this.listeners.get(e);return!(!o||!o.length)&&(o.forEach(function(e){var t;(t=e.callback).call.apply(t,[e.vm].concat(n))}),!0)}}]),n}()),o=function(e){return"socket_"+function(e,t){t=Object.assign({pascalCase:!1},t);var n=function(e){return t.pascalCase?e.charAt(0).toUpperCase()+e.slice(1):e};return 0===(e=Array.isArray(e)?e.map(function(e){return e.trim()}).filter(function(e){return e.length}).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():/^[a-z\d]+$/.test(e)?n(e):(e!==e.toLowerCase()&&(e=function(e){for(var t=!1,n=!1,r=!1,o=0;o<e.length;o++){var i=e[o];t&&/[a-zA-Z]/.test(i)&&i.toUpperCase()===i?(e=e.slice(0,o)+"-"+e.slice(o),t=!1,r=n,n=!0,o++):n&&r&&/[a-zA-Z]/.test(i)&&i.toLowerCase()===i?(e=e.slice(0,o-1)+"-"+e.slice(o-1),r=n,n=!1,t=!0):(t=i.toLowerCase()===i,r=n,n=i.toUpperCase()===i)}return e}(e)),n(e=e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(e,t){return t.toUpperCase()})))}(e.replace("SOCKET",""))},i=function(e){return"function"==typeof e},s=["connect","error","disconnect","reconnect","reconnect_attempt","reconnecting","reconnect_error","reconnect_failed","connect_error","connect_timeout","connecting","ping","pong"],c=function(){function i(t,n){e(this,i),this.Socket=t,n&&(this.store=n),this.registerEventHandler()}return t(i,[{key:"registerEventHandler",value:function(){var e=this,t=this.Socket.onevent;this.Socket.onevent=function(o){t.call(e.Socket,o),r.emit.apply(r,n(o.data)),e.store&&e.passToStore("SOCKET_"+o.data[0],[].concat(n(o.data.slice(1))))};var o=this;s.forEach(function(e){o.Socket.on(e,function(t){r.emit(e,t),o.store&&o.passToStore("SOCKET_"+e,t)})})}},{key:"passToStore",value:function(e,t){if(e.startsWith("SOCKET_")){for(var n in this.store._mutations){n.split("/").pop()===e.toUpperCase()&&this.store.commit(n,t)}for(var r in this.store._actions){var i=r.split("/").pop();if(i.startsWith("socket_"))i===o(e)&&this.store.dispatch(r,t)}}}}]),i}();return{install:function(e,t,n){if(!((o=t)&&i(o.on)&&i(o.emit)))throw new Error("[vue-socket.io-ext] you have to pass `socket.io-client` instance to the plugin");var o,s=new c(t,n);e.prototype.$socket=s.Socket,e.mixin(function(e){return{created:function(){var t=this,n=this.$options.sockets;this.$options.sockets=new Proxy({},{set:function(n,r,o){return e.addListener(r,o,t),n[r]=o,!0},deleteProperty:function(n,r){return e.removeListener(r,t.$options.sockets[r],t),delete n.key,!0}}),n&&Object.keys(n).forEach(function(e){t.$options.sockets[e]=n[e]})},beforeDestroy:function(){var e=this,t=this.$options.sockets;t&&Object.keys(t).forEach(function(t){delete e.$options.sockets[t]})}}}(r))}}});
