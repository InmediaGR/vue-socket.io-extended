!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueSocketIOExt=e()}(this,function(){"use strict";String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return this.substr(!e||e<0?0:+e,t.length)===t});var t=function(t){return"socket_"+function(t,e){e=Object.assign({pascalCase:!1},e);var n=function(t){return e.pascalCase?t.charAt(0).toUpperCase()+t.slice(1):t};return 0===(t=Array.isArray(t)?t.map(function(t){return t.trim()}).filter(function(t){return t.length}).join("-"):t.trim()).length?"":1===t.length?e.pascalCase?t.toUpperCase():t.toLowerCase():/^[a-z\d]+$/.test(t)?n(t):(t!==t.toLowerCase()&&(t=function(t){for(var e=!1,n=!1,r=!1,o=0;o<t.length;o++){var i=t[o];e&&/[a-zA-Z]/.test(i)&&i.toUpperCase()===i?(t=t.slice(0,o)+"-"+t.slice(o),e=!1,r=n,n=!0,o++):n&&r&&/[a-zA-Z]/.test(i)&&i.toLowerCase()===i?(t=t.slice(0,o-1)+"-"+t.slice(o-1),r=n,n=!1,e=!0):(e=i.toLowerCase()===i,r=n,n=i.toUpperCase()===i)}return t}(t)),n(t=t.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(t,e){return e.toUpperCase()})))}(t.replace("SOCKET",""))},e=function(t){return"function"==typeof t},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},i=new(function(){function t(){n(this,t),this.listeners=new Map}return r(t,[{key:"addListener",value:function(t,n,r){e(n)&&(this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push({callback:n,vm:r}))}},{key:"removeListener",value:function(t,n,r){if(e(n)){var o=(this.listeners.get(t)||[]).filter(function(t){return t.callback!==n||t.vm!==r});o.length>0?this.listeners.set(t,o):this.listeners.delete(t)}}},{key:"emit",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];(this.listeners.get(t)||[]).forEach(function(t){var e;(e=t.callback).call.apply(e,[t.vm].concat(n))})}}]),t}()),s=["connect","error","disconnect","reconnect","reconnect_attempt","reconnecting","reconnect_error","reconnect_failed","connect_error","connect_timeout","connecting","ping","pong"],c=function(){function e(t,r){n(this,e),this.Socket=t,r&&(this.store=r),this.registerEventHandler()}return r(e,[{key:"registerEventHandler",value:function(){var t=this,e=this.Socket.onevent;this.Socket.onevent=function(n){e.call(t.Socket,n),i.emit.apply(i,o(n.data));var r,s=(r=n.data,Array.isArray(r)?r:Array.from(r)),c=s[0],a=s.slice(1);t.passToStore("SOCKET_"+c,[].concat(o(a)))},s.forEach(function(e){t.Socket.on(e,function(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];i.emit.apply(i,[e].concat(r)),t.passToStore("SOCKET_"+e,[].concat(r))})})}},{key:"passToStore",value:function(e,n){var r=this;if(this.store&&e.startsWith("SOCKET_")){var o,i=(o=n)&&o.length<=1?o[0]:o;Object.keys(this.store._mutations).forEach(function(t){t.split("/").pop()===e.toUpperCase()&&r.store.commit(t,i)}),Object.keys(this.store._actions).forEach(function(n){var o=n.split("/").pop();o.startsWith("socket_")&&(o===t(e)&&r.store.dispatch(n,i))})}}}]),e}();var a,u="undefined"!=typeof Proxy&&("function"==typeof(a=Proxy)&&/native code/.test(a.toString()));return{install:function(t,n,r){if(!((o=n)&&e(o.on)&&e(o.emit)))throw new Error("[vue-socket.io-ext] you have to pass `socket.io-client` instance to the plugin");var o,s=new c(n,r);t.prototype.$socket=s.Socket,t.mixin(function(t){return{created:function(){var e=this,n=this.$options.sockets,r=void 0===n?{}:n;Object.keys(r).forEach(function(n){t.addListener(n,r[n],e)}),u&&(this.$options.sockets=new Proxy(r,{set:function(n,r,o){return t.addListener(r,o,e),n[r]=o,!0},deleteProperty:function(n,r){return t.removeListener(r,e.$options.sockets[r],e),delete n.key,!0}}))},beforeDestroy:function(){var e=this,n=this.$options.sockets,r=void 0===n?{}:n;Object.keys(r).forEach(function(n){u||t.removeListener(n,r[n],e),delete e.$options.sockets[n]})}}}(i))}}});
